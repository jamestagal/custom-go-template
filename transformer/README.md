# Transformer Package

The transformer package is responsible for transforming the AST (Abstract Syntax Tree) generated by the parser into Alpine.js compatible HTML.

## Overview

This package contains the core transformation logic for the custom Go template engine. It takes the AST nodes and transforms them into HTML with Alpine.js directives, ensuring proper reactivity and integration with Alpine.js.

## Key Components

### Transformer

The main entry point for transforming an AST into Alpine.js compatible HTML:

```go
// TransformAST transforms the AST into Alpine.js compatible HTML
func TransformAST(ast *ast.AST) string {
    // Reset component tracking
    resetComponentTracking()
    
    // Transform the AST nodes
    return transformNodes(ast.Nodes)
}
```

### Alpine.js Data Formatting

Formats data for Alpine.js compatibility:

```go
// alpineDataFormatter formats data for Alpine.js compatibility
func alpineDataFormatter(data interface{}) string {
    // Convert data to JSON and ensure it's Alpine.js compatible
    // ...
}
```

### Conditionals

Transforms conditional nodes into Alpine.js `x-if`, `x-else-if`, and `x-else` directives:

```go
// transformConditional transforms a conditional node into Alpine.js compatible HTML
func transformConditional(node *ast.Conditional) string {
    // Transform the conditional into Alpine.js directives
    // ...
}
```

### Loops

Transforms loop nodes into Alpine.js `x-for` directives:

```go
// transformLoop transforms a loop node into Alpine.js compatible HTML
func transformLoop(node *ast.Loop) string {
    // Transform the loop into Alpine.js directives
    // ...
}
```

### Components

Handles component tracking and transformation:

```go
// transformComponent transforms a component node into Alpine.js compatible HTML
func transformComponent(node *ast.Component) string {
    // Track and transform components
    // ...
}
```

### Text

Handles whitespace preservation in text nodes:

```go
// preserveWhitespace preserves meaningful whitespace in text nodes
func preserveWhitespace(text string) string {
    // Preserve meaningful whitespace
    // ...
}
```

## Usage

The transformer package is used by the renderer to transform the AST into Alpine.js compatible HTML:

```go
// Import the transformer package
import "github.com/jimafisk/custom_go_template/transformer"

// Parse the template into an AST
ast := parser.Parse(template)

// Transform the AST into Alpine.js compatible HTML
html := transformer.TransformAST(ast)

// Render the HTML
renderer.Render(html)
```

## Testing

Each component of the transformer package has corresponding test files to ensure proper transformation:

- `conditionals_test.go`: Tests for conditional transformations
- `loops_test.go`: Tests for loop transformations
- `nested_test.go`: Tests for nested structures (conditionals in loops, loops in conditionals)

Run the tests with:

```bash
go test ./transformer -v
```

## Documentation

For more detailed information on the template syntax and transformation rules, see:

- [Template Syntax](../docs/template-syntax.md)
- [Transformation Rules](../docs/transformation-rules.md)
